<?xml version="1.0" encoding="UTF-8"?>
<project basedir="../../../../.." default="buildAndTestRun" name="MiddlegenClassGeneration">

    <taskdef classname="middlegen.MiddlegenTask" name="middlegen">
        <classpath>
            <pathelement location="/usr/java/middlegen/middlegen-2.0-vo.jar"/>
            <pathelement location="/usr/java/middlegen/middlegen-hibernate-plugin-2.0-vo.jar"/>
            <pathelement location="/usr/java/Middlegen-Hibernate-r4/lib/velocity-1.4-dev.jar"/>
        </classpath>
    </taskdef>
    
    <property name="rega_package" location="${basedir}/com/pharmadm/custom/rega"/>
    <property name="hibernate_dest" location="${rega_package}/persistent"/>
    <property name="hibernate_dest_2" location="${rega_package}/persistent2"/>
    <property file="${rega_package}/log4j.properties"/>
    
    <target name="clean">
        <delete file="${user.home}/.middlegen/virodb-prefs.properties"/>
        <delete dir="${hibernate_dest}"/>
    </target>
    
    
    <target name="run_middlegen">
        <mkdir dir="${hibernate_dest}"/>
        <middlegen 
            appname="virodb" 
            databaseurl="jdbc:oracle:thin:@helium:1521:virodb" 
            driver="oracle.jdbc.driver.OracleDriver" 
            gui="false" 
            password="viro" 
            username="viro">
            
            
            
            <!--
            Singular attributes: Those look somewhat strange (often are actually plural forms)
                                 to circumvent a bug in the Hibernate plugin for Middlegen 2.0.
                                 It will be necessary to fix these cases when the plugin gets fixed.
            Plural attributes: Whenever possible, a word was interpreted as English and given an English plural.
                               In case of a unambiguously Dutch word, the Dutch plural was used.
            Sometimes, singular and plural attributes are set to fix an uppercase/lowercase issue.
            -->
            
            
            <table name="PATIENT_REQUEST" />
            <table name="PATIENT_SAMPLE_REQUEST" />
            <table name="REQUESTER"/>
            <table name="AA_SEQUENCE"/>
            
            
            <!-- not in rega's DB
            <table name="ACME_ADDRESS"/>
            <table name="ACME_EMPLOYEE"/>
            <table name="ACME_LPROJECT"/>
            <table name="ACME_PHONE"/>
            <table name="ACME_PROJECT"/>
            <table name="ACME_PROJ_EMP"/>
            <table name="ACME_RESPONS" singular="AcmeResponses"/>
            <table name="ACME_SALARY"/>
            -->
            
            <table name="ALGO_RESULT"/>
            <table name="ATOMFORMALCHARGES" singular="AtomFormalCharge"/>
            <table name="ATOMRADICALS" singular="AtomRadical" plural="AtomRadicals"/>
            <table name="ATOMS"/>
            <table name="ATOMSTEREOPARITIES" singular="AtomStereoparity" plural="AtomStereoparities"/>
            <table name="ATOMUNKNOWNS" singular="AtomUnknown" plural="AtomUnknowns"/>
            <table name="BONDS"/>
            <table name="BUDDY"/>
            <table name="CALC_RESULT"/>
            <table name="CATCH_OLD"/>
            <table name="CATCH_XLS" singular="CatchXls"/>
            <table name="CATHETER_PLACEMENT" />
            <table name="CELL_APPEARANCE"/>
            <table name="CELL_APP_CLINICAL"/>
            <table name="CELL_APP_LAB"/>
            <table name="CELL_STOCK"/>
            <table name="CLINICAL_ISOLATE"/>
            <table name="CODING_REGION"/>
            <table name="COD_AIDS_DEF_ILLNESS"/>
            <table name="COD_ALGORITHM"/>
            <table name="COD_AMINO_ACID"/>
            <table name="COD_ASSAY"/>
            <table name="COD_ATOM"/>
            <table name="COD_ATOM_GROUP"/>
            <table name="COD_ATOM_PERIOD"/>
            <table name="COD_BASE_UNIT"/>
            <table name="COD_INFECTION_SOURCE" />
            <table name="COD_TRANSMISSION_ROUTE" />
            <table name="COD_CIVIL_STATUS" />
            <table name="COD_CIVIL_STATUS_ALT"/>
            <table name="COD_CALC_TEST"/>
            <table name="COD_CATHETER_KIND" />
            <table name="COD_CDC_CLASS" />
            <table name="COD_CELL_APP_TYPE"/>
            <table name="COD_CELL_LINE"/>
            <table name="COD_CLIN_ISOL_TYPE"/>
            <table name="COD_CODON"/>
            <table name="COD_CONTACT_RELATION"/>
            <table name="COD_DRUG_DEFAULT_SOLV"/>
            <table name="COD_ELEM_TEST"/>
            <table name="COD_PHENOTYPE"/>
            <table name="COD_GEOGRAPHY"/>
            <table name="COD_GENDER" />
            <table name="COD_GENDER_ALT"/>
            <table name="COD_PARTNER_HIV_STATUS"/>
            <table name="COD_PARTNER_HIV_STATUS_ALT"/>
            <table name="COD_LAB_STRAIN"/>
            <table name="COD_LAB_TEST"/>
            <table name="COD_COUNTRY" />
            <table name="COD_COUNTRY_ALT"/>
            <table name="COD_MEDICATION"/>
            <table name="COD_MEDICATION_BOM"/>
            <table name="COD_MED_FREQUENCY"/>
            <table name="COD_MED_REPETITION" />
            <table name="COD_MEDICATION_ALT"/>
            <table name="COD_MED_PERIOD"/>
            <table name="COD_MED_TAKING_CONDITION" />
            <table name="COD_MED_FREQUENCY_ALT"/>
            <table name="COD_MED_REPETITION_ALT"/>
            <table name="COD_MED_PERIOD_ALT"/>
            <table name="COD_MEDICAL_ADHEARANCE"/>
            <table name="COD_MEDICAL_ADHEARANCE_ALT"/>
            <table name="COD_MED_TAKING_COND_ALT"/>
            <table name="COD_NATIONALITY" />
            <table name="COD_NA_TYPE"/>
            <table name="COD_EDUCATION" />
            <table name="COD_EDUCATION_ALT"/>
            <table name="COD_PROTOCOL"/>
            <table name="COD_RACE" singular="CodRas" />
            <table name="COD_RACE_ALT"/>
            <table name="COD_MED_ADHEARANCE_REASON_ALT"/>
            <table name="COD_MED_ADHEARANCE_REASON"/>
            <table name="COD_THERAPY_FAILURE_REASON"/>
            <table name="COD_THERAPY_FAILURE_REASON_ALT"/>
            <table name="COD_COUNTRY_REGION"/>
            <table name="COD_REQUEST_TEST"/>
            <table name="COD_REQ_CALC_TEST"/>
            <table name="COD_REQ_LAB_TEST"/>
            <table name="COD_LIST_CODE"/>
            <table name="COD_LIST_CODE_VALUE_ALT"/>
            <table name="COD_LIST_CODE_VALUE"/>
            <table name="COD_RESULT_RELATION"/>
            <table name="COD_VALUE_TYPE"/>
            <table name="COD_SEX_TRANSM_FACTOR"/>
            <table name="COD_SEXUAL_ADHEARANCE"/>
            <table name="COD_SEXUAL_ADHEARANCE_ALT"/>
            <table name="COD_STD"/>
            <table name="COD_SOLVENT"/>
            <table name="COD_SYMPTOM" />
            <table name="COD_TEST_DEPEND"/>
            <table name="COD_TRANSM_ROUTE"/>
            <table name="COD_TROPISM"/>
            <table name="COD_EXECUTOR_HEP"/>
            <table name="COD_UNIT"/>
            <table name="COD_UNIT_ALT"/>
            <table name="COD_VIRAL_CLIN_ISOL_TYPE"/>
            <table name="COD_VIRUS_APP_TYPE"/>
            <table name="COD_WEIGHT_SCORE"/>
            <table name="COD_WORK_CONDITION" />
            <table name="COD_WORK_CONDITION_ALT"/>
            <table name="COD_AREA" />
            <table name="COD_SOCIAL_STATUS"/>
            <table name="COD_SOCIAL_STATUS_ALT"/>
            <table name="CONNECTEDMOIETIES" singular="ConnectedMoiety" plural="ConnectedMoieties"/>
            <table name="CONTACT"/>
            <table name="CONTACT_PERSON" />
            <table name="DESCRIPTORS"/>
            <table name="DRUG_COMPOUND"/>
            <table name="DRUG_STOCK"/>
            <table name="DRUG_WORK_MECHANISM"/>
            <table name="DRUG_WORK_MECHANISM_PROB"/>
            
            <!-- not in rega's DB
            <table name="DSD_FRAME"/>
            <table name="DSD_FRAM_DIM"/>
            <table name="DSD_FRAM_FACT"/>
            <table name="DS_PROJECT"/>
            <table name="DS_PROJ_ATTR"/>
            <table name="DS_PROJ_DIM"/>
            <table name="DS_PROJ_DIM_ATTR"/>
            <table name="DS_PROJ_FACT"/>
            <table name="DS_PROJ_GR_ATTR"/>
            -->
            
            <table name="EXPERIMENT"/>
            <table name="FM_CATCH_1998_2002"/>
            <table name="FUSEDMOIETIES" singular="FusedMoiety" plural="FusedMoieties"/>
            <table name="GENE"/>
            <table name="GENE_PROTEIN_ENCODING"/>
            <table name="HAART"/>
            <table name="GENERAL_PRACTITIONER" />
            <table name="INTERVIEW"/>
            <table name="LAB_PROTEIN"/>
            <table name="LAB_REGION"/>
            <table name="LOB_SEQ"/>
            <table name="MEASUREMENT"/>
            <table name="DRUG_COMPOUND_MEDICATION"/>
            <table name="MOIETIES"/>
            <table name="MOIETYATOMS" singular="MoietyAtom" plural="MoietyAtoms"/>
            <table name="MOIETYCOUNTS" singular="MoietyCount" plural="MoietyCounts"/>
            <table name="MOIETYLINKERS" singular="MoietyLinker" plural="MoietyLinkers"/>
            <table name="MOLECULES" singular="Molecule"/>
            <table name="MOLECULE_KB"/>
            <table name="ADDRESS_BOOK"/>
	    <!--
            <table name="NAW_BU"/>
	    -->
            <table name="NA_EXTRACTION"/>
            <table name="NT_SEQUENCE"/>
            <table name="PATIENT"/>
            <table name="PATIENT_ABUSUS" singular="PatientAbusus"/>
            <table name="PATIENT_AIDS_DEF_ILLNESS"/>
            <table name="SOURCE_PATIENT_MEDICATION"/>
            <table name="PATIENT_SOURCE_PATIENT"/>
            <table name="PATIENT_BUDDY"/>
            <table name="PATIENT_CDC_CLASS" />
            <table name="PATIENT_CONTACT_PERSON"/>
            <table name="PATIENT_GENERAL_PRACTITIONER" />
            <table name="PATIENT_CHILD" />
            <table name="PATIENT_MEDICATION"/>
            <table name="PATIENT_SEX_TRANSM_FACTOR"/>
            <table name="PATIENT_STD"/>
            <table name="PATIENT_SYMPTOM" />
            <table name="PATIENT_HOME_TREATMENT"/>
            <table name="PATIENT_TRANSMISSION_ROUTE"/>
            <table name="PROJECT"/>
            <table name="PROTEIN"/>
            <table name="PROTEIN_ENCODING"/>
            <table name="PROTEIN_REF_SEQ_POS"/>
            <table name="READING_FRAME_SHIFT"/>
            <table name="REGION"/>
            <table name="REGION_REF_SEQ_POS"/>
            <table name="REQUEST"/>
            <table name="RESISTANCE"/>
            <table name="RESISTANCE_DRUG"/>
            <table name="RESULT"/>
            <table name="RESULT_DEPEND"/>
            <table name="SAMPLE"/>
            <table name="SEQUENCE_AA_DELETION"/>
            <table name="SEQUENCE_AA_INSERTION"/>
            <table name="SEQUENCE_AA_MUTATION"/>
            <table name="SEQUENCE_NT_DELETION"/>
            <table name="SEQUENCE_NT_INSERTION"/>
            <table name="SEQUENCE_NT_MUTATION"/>
            <table name="SEQ_DATA_CATCH"/>
            <table name="SPREAD_DATA"/>
            <table name="PATIENT_SAMPLE" />
            <table name="SYMPTOM_MEDICATION"/>
            <table name="SYSCOD_AUTOKEYTABLES" singular="SyscodAutoKeyTable"/>
            <table name="SYSCOD_ID_SOURCE"/>
            <table name="SYSCOD_IMP_ID_SOURCE"/>
            <table name="SYSCOD_RLS_ID_SOURCE"/>
            <table name="SYSCOD_ROLE"/>
            <table name="SYSCOD_ROLE_GROUP"/>
            <table name="HOME_TREATMENT"/>
            <table name="NURSING_UNIT" />
            <table name="VIRAL_CLIN_ISOLATE"/>
            <table name="VIRUS" singular="Virus" plural="Viruses"/>
            <table name="VIRUS_APPEARANCE"/>
            <table name="VIRUS_APP_CHIMERIC"/>
            <table name="VIRUS_APP_CLINICAL"/>
            <table name="VIRUS_APP_LAB"/>
            <table name="VIRUS_APP_SELECTED"/>
            <table name="VIRUS_APP_SITE_DIR"/>
            <table name="VIRUS_CHIMERIC_FG"/>
            <table name="VIRUS_CLADE"/>
            <table name="VIRUS_FAMILY"/>
            <table name="VIRUS_GENUS" singular="VirusGenuses" plural="VirusGenuses"/>
            <table name="VIRUS_SEROTYPE"/>
            <table name="VIRUS_SITE_DIR_FG"/>
            <table name="VIRUS_SITE_DIR_FG_MUT"/>
            <table name="VIRUS_STOCK"/>
            <table name="WORK_MECHANISM"/>
            <table name="WORK_MECHANISM_BOM"/>
            <hibernate
                destination="${basedir}"
                package="com.pharmadm.custom.rega.persistent"                
            />
       </middlegen>
       <fixcrlf srcDir="${hibernate_dest}"/>
       <patch 
           patchfile="${rega_package}/queryeditor/AaSequence.patch"
           originalfile="${hibernate_dest}/AaSequence.hbm.xml"
           ignorewhitespace="true"/>
       <patch 
           patchfile="${rega_package}/queryeditor/NtSequence.patch"
           originalfile="${hibernate_dest}/NtSequence.hbm.xml"/>
    </target>
    
    <target name="hbm2java">
        <exec executable="/usr/java/hibernate-extensions-2.1.2/tools/bin/hbm2java" failonerror="true">
            <arg file="${hibernate_dest}"/>
            <arg value="--output=${basedir}"/>
        </exec>
    </target>

    <target name="build">
        <javac 
            srcdir="${hibernate_dest}"
            fork="true"
            memoryMaximumSize="400m">
            <classpath>
                <pathelement location="/usr/java/hibernate-2.0.3/lib/commons-lang.jar"/>
            </classpath>
        </javac>
    </target>
     
    <target name="classlist">
        <property name="listfile" location="${hibernate_dest}/classlist"/>
        <apply 
            executable="ls"
            output="${listfile}">
            <fileset dir="${hibernate_dest}">
                <patternset>
                    <include name="*.class"/>
                    <exclude name="*PK.class"/>
                </patternset>
            </fileset>
        </apply>
        <replaceregexp 
            file="${listfile}"
            byline="true">
            <regexp pattern="${hibernate_dest}/"/>
            <substitution expression=""/>
        </replaceregexp>
        <replaceregexp 
            file="${listfile}"
            byline="true">
            <regexp pattern=".class"/>
            <substitution expression=""/>
        </replaceregexp>
    </target>

        <!--
    <target name="all" depends="clean,run_middlegen,hbm2java,build,classlist"/>
    -->
    <target name="testrun">
        <java
            fork="true"
            classname="com.pharmadm.custom.rega.queryeditor.HibernateViroDB">
            <classpath>
               <pathelement location="/usr/java/hibernate-2.0.3/hibernate2.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/ant.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/c3p0.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/cglib-asm.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/commons-beanutils.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/commons-collections.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/commons-dbcp.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/commons-lang.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/commons-logging.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/commons-pool.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/connector.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/dom4j.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/jaas.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/jcs.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/jdbc2_0-stdext.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/jta.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/junit.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/odmg.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/optional.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/proxool.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/xalan.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/xerces.jar"/>
               <pathelement location="/usr/java/hibernate-2.0.3/lib/xml-apis.jar"/>
               <pathelement path="${basedir}"/>
            </classpath>
        </java>
    </target>
    
    <target name="all" depends="hbm2java,build,classlist"/>
    <target name="buildAndTestRun" depends="hbm2java,build,testrun"/>

</project>
